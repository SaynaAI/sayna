# Sayna Configuration File Example
#
# This file demonstrates all available configuration options.
# Copy this file to config.yaml and customize as needed.
#
# Usage: sayna -c config.yaml
#
# Priority: Environment variables > YAML values > Defaults
# This means you can override any value in this file by setting
# the corresponding environment variable.

# Server configuration
server:
  host: "0.0.0.0"      # ENV: HOST
  port: 3001           # ENV: PORT

# LiveKit configuration
livekit:
  url: "ws://localhost:7880"              # ENV: LIVEKIT_URL
  public_url: "http://localhost:7880"     # ENV: LIVEKIT_PUBLIC_URL
  api_key: "your-livekit-api-key"         # ENV: LIVEKIT_API_KEY
  api_secret: "your-livekit-api-secret"   # ENV: LIVEKIT_API_SECRET

# Provider API keys
providers:
  deepgram_api_key: "your-deepgram-api-key"     # ENV: DEEPGRAM_API_KEY
  elevenlabs_api_key: "your-elevenlabs-api-key" # ENV: ELEVENLABS_API_KEY

  # Google Cloud settings (used for both Speech-to-Text and Text-to-Speech)
  # Authentication options (in order of precedence):
  # 1. Path to service account JSON file
  # 2. JSON content string (starts with '{')
  # 3. Empty string to use Application Default Credentials (ADC)
  # Note: project_id is automatically extracted from the credentials JSON
  google_credentials: ""                         # ENV: GOOGLE_APPLICATION_CREDENTIALS

  # Azure Speech Services settings (used for Speech-to-Text)
  # Get these from Azure Portal → Your Speech resource → Keys and Endpoint
  # IMPORTANT: The subscription key is tied to a specific Azure region.
  # Using a key with the wrong region will result in 401 Unauthorized errors.
  azure_speech_subscription_key: ""              # ENV: AZURE_SPEECH_SUBSCRIPTION_KEY
  # Azure region where your Speech resource was created
  # Common regions: eastus, westus, westus2, westeurope, northeurope, eastasia, southeastasia
  azure_speech_region: "eastus"                  # ENV: AZURE_SPEECH_REGION (default: eastus)

# STT Provider Configuration (optional - can also be set via WebSocket config)
# stt:
#   provider: deepgram  # Options: "deepgram", "google", "elevenlabs", "microsoft-azure"
#   # Google-specific settings (only used when provider is "google")
#   google:
#     location: global           # Options: global, us, eu, asia-southeast1, etc.
#     recognizer_id: ""          # Optional: pre-configured recognizer ID
#     model: latest_long         # Options: latest_long, latest_short, chirp_2, telephony

# LiveKit recording configuration (S3)
recording:
  s3_bucket: "my-recordings"              # ENV: RECORDING_S3_BUCKET
  s3_region: "us-west-2"                  # ENV: RECORDING_S3_REGION
  s3_endpoint: "https://s3.amazonaws.com" # ENV: RECORDING_S3_ENDPOINT
  s3_access_key: "your-access-key"        # ENV: RECORDING_S3_ACCESS_KEY
  s3_secret_key: "your-secret-key"        # ENV: RECORDING_S3_SECRET_KEY

# Cache configuration
cache:
  path: "/var/cache/sayna"  # ENV: CACHE_PATH (if omitted, uses in-memory cache)
  ttl_seconds: 2592000      # ENV: CACHE_TTL_SECONDS (default: 30 days)

# Authentication configuration
auth:
  required: false                             # ENV: AUTH_REQUIRED (true/false/1/0/yes/no)
  service_url: "https://auth.example.com"     # ENV: AUTH_SERVICE_URL
  signing_key_path: "/path/to/key.pem"        # ENV: AUTH_SIGNING_KEY_PATH
  api_secret: "your-api-secret"               # ENV: AUTH_API_SECRET
  timeout_seconds: 5                          # ENV: AUTH_TIMEOUT_SECONDS

# SIP configuration (optional)
# Used for SIP trunk integration and webhook forwarding
sip:
  room_prefix: "sip-"                         # ENV: SIP_ROOM_PREFIX
  allowed_addresses:                          # ENV: SIP_ALLOWED_ADDRESSES (comma-separated)
    - "192.168.1.0/24"
    - "10.0.0.1"

  # REQUIRED if hooks are configured: Global signing secret for webhook authentication
  # All outbound SIP webhooks are signed with HMAC-SHA256 for security
  # Generate with: openssl rand -hex 32
  # See docs/livekit_webhook.md#webhook-signing for details
  hook_secret: "your-global-signing-secret"   # ENV: SIP_HOOK_SECRET (min 16 chars, 32+ recommended)

  # Downstream webhook endpoints for SIP event forwarding
  # Each hook receives participant_joined events for matching SIP domains
  # All requests include X-Sayna-Signature header for verification
  #
  # Runtime management: Hooks can be added/replaced at runtime via the
  # POST /sip/hooks REST endpoint. Runtime changes are persisted to
  # <cache_path>/sip_hooks.json and merged with this config on startup.
  # Note: Runtime hooks use the global hook_secret (per-hook secrets not supported via API)
  hooks:                                      # ENV: SIP_HOOKS_JSON (JSON array with optional "secret" field)
    - host: "example.com"                     # SIP domain to match (case-insensitive)
      url: "https://webhook.example.com/events"  # HTTPS strongly recommended
      # Optional: per-hook secret override (omit to use global hook_secret)
      # Use for multi-tenant deployments or zero-trust architectures

    - host: "another.com"
      url: "https://webhook2.example.com/events"
