# git-cliff configuration for Sayna changelog generation
# https://git-cliff.org/docs/configuration
#
# Conventional Commit Format: <type>(<scope>): <description>
#
# Recommended scopes for Sayna:
#   stt      - Speech-to-text changes
#   tts      - Text-to-speech changes
#   ws       - WebSocket handler changes
#   livekit  - LiveKit integration changes
#   api      - REST API changes
#   config   - Configuration changes
#   auth     - Authentication changes
#   noise    - DeepFilterNet noise filtering changes
#
# Examples:
#   feat(tts): add ElevenLabs provider support
#   fix(ws): handle reconnection edge case
#   perf(stt): optimize audio buffer processing

[changelog]
# Changelog header
header = """
# Changelog

All notable changes to Sayna will be documented in this file.

"""
# Template for the changelog body
body = """
{%- macro remote_url() -%}
  https://github.com/saynaai/sayna
{%- endmacro -%}

{% if version -%}
## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else -%}
## [Unreleased]
{% endif -%}

{% for group, commits in commits | group_by(attribute="group") %}
### {{ group | striptags | trim | upper_first }}
{% for commit in commits
| filter(attribute="scope")
| sort(attribute="scope") %}
- **{{ commit.scope }}:** {{ commit.message | upper_first }}
  {%- if commit.remote.username %} by @{{ commit.remote.username }}{%- endif -%}
  {%- if commit.remote.pr_number %} in [#{{ commit.remote.pr_number }}]({{ self::remote_url() }}/pull/{{ commit.remote.pr_number }}){%- endif %}
{%- endfor -%}
{% for commit in commits %}
{%- if not commit.scope %}
- {{ commit.message | upper_first }}
  {%- if commit.remote.username %} by @{{ commit.remote.username }}{%- endif -%}
  {%- if commit.remote.pr_number %} in [#{{ commit.remote.pr_number }}]({{ self::remote_url() }}/pull/{{ commit.remote.pr_number }}){%- endif %}
{% endif -%}
{% endfor %}
{% endfor %}
"""
# Template for the changelog footer
footer = """
<!-- Generated by git-cliff -->
"""
# Remove leading and trailing whitespace from the generated changelog
trim = true
# Postprocessors for additional formatting
postprocessors = [
  { pattern = '<REPO>', replace = "https://github.com/saynaai/sayna" },
]

[git]
# Parse conventional commits
conventional_commits = true
# Filter out commits that don't match conventional commit format
filter_unconventional = true
# Process each line of a commit as an individual commit
split_commits = false
# Regex for commit preprocessing
commit_preprocessors = [
  # Remove issue numbers from commit messages
  { pattern = '\((\w+\s)?#([0-9]+)\)', replace = "" },
]
# Regex for parsing and grouping commits
commit_parsers = [
  # Skip merge commits
  { message = "^Merge", skip = true },
  # Breaking changes - always at the top
  { message = "^.*!:", group = "<!-- 0 -->Breaking Changes" },
  { body = ".*BREAKING CHANGE.*", group = "<!-- 0 -->Breaking Changes" },
  # Feature additions
  { message = "^feat", group = "<!-- 1 -->Features" },
  # Bug fixes
  { message = "^fix", group = "<!-- 2 -->Bug Fixes" },
  # Performance improvements
  { message = "^perf", group = "<!-- 3 -->Performance Improvements" },
  # Documentation
  { message = "^docs", group = "<!-- 4 -->Documentation" },
  # Refactoring
  { message = "^refactor", group = "<!-- 5 -->Refactoring" },
  # Styling (code style, formatting)
  { message = "^style", group = "<!-- 6 -->Styling" },
  # Testing
  { message = "^test", group = "<!-- 7 -->Testing" },
  # Build system
  { message = "^build", group = "<!-- 8 -->Build System" },
  # CI/CD
  { message = "^ci", group = "<!-- 9 -->CI/CD" },
  # Chores and miscellaneous
  { message = "^chore", group = "<!-- 10 -->Miscellaneous" },
  # Revert commits
  { message = "^revert", group = "<!-- 11 -->Reverted Changes" },
]
# Protect breaking changes from being skipped by later parsers
protect_breaking_commits = true
# Filter commits by their parsed values
filter_commits = false
# Sort commits within groups by timestamp
sort_commits = "oldest"
# Link parsing for GitHub integration
link_parsers = [
  { pattern = "#(\\d+)", href = "https://github.com/saynaai/sayna/issues/$1" },
  { pattern = "RFC(\\d+)", href = "https://rfcs.rust-lang.org/rfc-$1.html" },
]

[remote.github]
owner = "saynaai"
repo = "sayna"
